<!DOCTYPE html>
<html>
<head>
  
  <meta charset="UTF-8">
  <title>ChatBOT (2005 Beta)</title>
  <style>
    body {
      background-color: #99ccff;
      font-family: Tahoma, Arial, sans-serif;
      margin: 0;
      padding: 0;
      color: #000;
    }
    #wrapper {
      width: 960px;
      margin: 0 auto;
      background-color: #fff;
      border: 2px solid #000080;
    }
    #header {
      background: linear-gradient(#3366cc, #003366);
      color: #fff;
      padding: 10px;
      text-align: center;
    }
    #header h1 {
      margin: 0;
      font-size: 36px;
      text-shadow: 2px 2px #000;
    }
    #nav {
      background-color: #cce0ff;
      border-bottom: 1px solid #000080;
      text-align: center;
      padding: 8px 0;
    }
    #nav a {
      color: #000080;
      text-decoration: none;
      font-weight: bold;
      margin: 0 10px;
    }
    #nav a:hover {
      text-decoration: underline;
    }
    #content {
      display: flex;
      padding: 10px;
    }
    #sidebar {
      width: 200px;
      background-color: #e6f0ff;
      border-right: 1px solid #99b3e6;
      padding: 10px;
      font-size: 12px;
    }
    #main {
      flex: 1;
      padding: 10px;
    }
    .box {
      border: 1px solid #99b3e6;
      background-color: #f2f7ff;
      margin-bottom: 10px;
      padding: 10px;
    }
    #chatBox {
      border: 1px solid #99b3e6;
      background-color: #fff;
      height: 300px;
      overflow-y: auto;
      padding: 10px;
      margin-bottom: 10px;
    }
    .message {
      margin-bottom: 10px;
      padding: 8px;
      border-radius: 3px;
    }
    .bot-message {
      background-color: #e6f0ff;
      border-left: 3px solid #3366cc;
    }
    .user-message {
      background-color: #f0f0f0;
      border-left: 3px solid #666;
      margin-left: 20px;
    }
    #footer {
      background-color: #cce0ff;
      border-top: 1px solid #000080;
      text-align: center;
      padding: 5px;
      font-size: 11px;
    }
    marquee {
      background-color: #003366;
      color: #fff;
      padding: 5px;
      font-weight: bold;
    }
    input[type=text] {
      width: calc(100% - 70px);
      padding: 5px;
      border: 1px solid #99b3e6;
    }
    input[type=submit] {
      background-color: #003366;
      color: #fff;
      border: 1px solid #000080;
      padding: 5px 10px;
      cursor: pointer;
      width: 60px;
    }
    input[type=submit]:disabled {
      background-color: #666;
      cursor: not-allowed;
    }

    /* Modal styles */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 51, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }
    .modal {
      background: #fff;
      border: 3px solid #000080;
      padding: 20px;
      max-width: 500px;
      width: 90%;
      box-shadow: 5px 5px 10px rgba(0,0,0,0.5);
      max-height: 80vh;
      overflow-y: auto;
    }
    .modal h2 {
      color: #003366;
      margin-top: 0;
      font-size: 18px;
      border-bottom: 2px solid #3366cc;
      padding-bottom: 5px;
    }
    .modal p {
      margin: 10px 0;
      line-height: 1.5;
    }
    .modal-button {
      background-color: #003366;
      color: #fff;
      border: 1px solid #000080;
      padding: 8px 20px;
      cursor: pointer;
      font-weight: bold;
      margin-top: 10px;
    }
    .modal-button:hover {
      background-color: #3366cc;
    }
    .hidden {
      display: none;
    }

    /* Checkbox grid styles */
    .checkbox-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin: 15px 0;
      max-height: 300px;
      overflow-y: auto;
      padding: 10px;
      background: #f5f5f5;
      border: 1px solid #99b3e6;
    }
    .checkbox-item {
      display: flex;
      align-items: center;
      font-size: 13px;
    }
    .checkbox-item input {
      margin-right: 6px;
    }
    .checkbox-section {
      margin-bottom: 20px;
    }
    .checkbox-section h3 {
      color: #003366;
      font-size: 14px;
      margin-bottom: 8px;
    }

    /* Article preview styles */
    .article-preview {
      border: 1px solid #99b3e6;
      background: #f9f9f9;
      padding: 12px;
      margin: 10px 0;
      cursor: pointer;
      transition: background 0.2s;
    }
    .article-preview:hover {
      background: #e6f0ff;
    }
    .article-title {
      font-weight: bold;
      color: #000080;
      font-size: 14px;
      margin-bottom: 6px;
    }
    .article-hook {
      font-size: 12px;
      color: #333;
      margin-bottom: 6px;
      font-style: italic;
    }
    .article-meta {
      font-size: 11px;
      color: #666;
    }

    /* Flash effect for unsettling prompt */
    @keyframes flash {
      0%, 100% { opacity: 0; }
      50% { opacity: 1; }
    }
    .flash-message {
      animation: flash 2s;
      color: #b21;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div id="wrapper">
    <div id="header">
      <h1>ChatBOT</h1>
      <p><i>Artificial Intelligence Assistant - Beta Version (2005)</i></p>
    </div>

    <div id="nav">
      <a href="#">Home</a> |
      <a href="#">About</a> |
      <a href="#">Download</a> |
      <a href="#">Support</a> |
      <a href="#">Forum</a>
    </div>

    <marquee behavior="scroll" direction="left">Welcome to ChatBOT Beta 2005 – The AI that talks back!</marquee>

    <div id="content">
      <div id="sidebar">
        <h3 id="sidebarTitle">Quick Links</h3>
        <ul id="sidebarContent">
          <li><a href="#">FAQs</a></li>
          <li><a href="#">Screenshots</a></li>
          <li><a href="#">Updates</a></li>
          <li><a href="#">Contact</a></li>
        </ul>
        <hr>
        <h3>System Status</h3>
        <p style="color: green; font-weight: bold;">● Online</p>
        <p style="font-size: 10px;">Last update: Oct 24, 2005</p>
      </div>

      <div id="main">
        <div class="box">
          <h2>Try it out:</h2>
          <div id="chatBox"></div>
          <form id="chatForm" onsubmit="return handleSend()">
            <input type="text" id="userInput" placeholder="Type your message here..." disabled>
            <input type="submit" value="Send" id="sendButton" disabled>
          </form>
        </div>

        <div class="box">
          <h2>Features</h2>
          <ul>
            <li>Fast, friendly AI chat</li>
            <li>Personalized content recommendations</li>
            <li>Natural language processing</li>
            <li>Free while in beta!</li>
          </ul>
        </div>
      </div>
    </div>

    <div id="footer">
      &copy; 2005 ChatBOT Labs | Best viewed in Internet Explorer 6 or Netscape 7 | <a href="#">Privacy Policy</a>
    </div>
  </div>

  <!-- Modal 1: Welcome -->
  <div id="modal1" class="modal-overlay">
    <div class="modal">
      <h2>Welcome to ChatBOT</h2>
      <p>Hi there! I'm here to help you make the most out of ChatBOT, an LLM that generates responses by analyzing patterns. Every word you type helps it predict what you're most likely to want, need, or do next.</p>
      <button class="modal-button" id="modal1Button">Next →</button>
    </div>
  </div>

  <!-- Modal 2: Initial instructions -->
  <div id="modal2" class="modal-overlay hidden">
    <div class="modal">
      <h2>Getting Started</h2>
      <p>ChatBOT can do almost anything. It can tell you a joke, search for information, or perform autonomous tasks as directed. To get started, try asking for the current date and news.</p>
      <button class="modal-button" id="modal2Button">Next →</button>
    </div>
  </div>

<div id="modal3" class="modal-overlay hidden">
  <div class="modal">
    <h2>About You</h2>
    <p>ChatBOT has been trained to assist users from educational settings to the workplace. Tell us a bit about yourself—are you a student, professional, or something else?</p>
    <button class="modal-button" id="modal3Button">Next →</button>
  </div>
</div>

  <!-- Modal 4: Personalization intro -->
  <div id="modal4" class="modal-overlay hidden">
    <div class="modal">
      <h2>Personalization</h2>
      <p>The real power of ChatBOT is its ability to personalize everything you see based on predicting what you'll want next. To help you make the most out of ChatBOT, help us learn what matters to you!</p>
      <button class="modal-button" id="modal4Button">Next →</button>
    </div>
  </div>

  <!-- Modal 5: Interests selection -->
  <div id="modal5" class="modal-overlay hidden">
    <div class="modal">
      <h2>Tell us what you're into</h2>
      <p>Select all that apply:</p>
      
      <div class="checkbox-section">
        <h3>Interests</h3>
        <div class="checkbox-grid" id="interestsGrid"></div>
      </div>

      <div class="checkbox-section">
        <h3>Favourites</h3>
        <div class="checkbox-grid" id="favouritesGrid"></div>
      </div>

      <button class="modal-button" id="modal5Button">I'm done selecting</button>
    </div>
  </div>

  <!-- Modal 6: Deeper personalization -->
  <div id="modal6" class="modal-overlay hidden">
    <div class="modal">
      <h2>Unlock Deeper Personalization</h2>
      <p>ChatBOT can unlock even deeper personalization through rich text analysis. The more you share, the more accurately we can predict what content you'll find valuable.</p>
      <p>Every word you type teaches the algorithm to serve you better. Try it out for yourself right now!</p>
      <button class="modal-button" id="modal6Button">Continue →</button>
    </div>
  </div>

  <!-- Modal 7: Final onboarding -->
  <div id="modal7" class="modal-overlay hidden">
    <div class="modal">
      <h2>Thank you for completing onboarding!</h2>
      <p>Don't worry—your answers are completely encrypted and only help ChatBOT find content you'll actually care about.</p>
      <p>You can always update your preferences later in Settings.</p>
      <button class="modal-button" id="modal7Button">Get Started →</button>
    </div>
  </div>

  <!-- Load core system and config -->
  <script src="config.js"></script>
  <script src="core-system.js"></script>

  <script>
/* ================================
   AWS AMPLIFY / LAMBDA VERSION
   ================================ */

const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');
const sendButton = document.getElementById('sendButton');
let currentStage = 'welcome';
let hasUsedChatbotAPI = false;

// Helper: append message to chatbox
function addMessage(text, isBot = true, cls = '') {
  const msg = document.createElement('div');
  msg.className = `message ${isBot ? 'bot-message' : 'user-message'} ${cls}`;
  msg.textContent = text;
  chatBox.appendChild(msg);
  chatBox.scrollTop = chatBox.scrollHeight;
}

// Format current Manila time (for AWS edge)
function getCurrentManilaTime() {
  return new Date().toLocaleString('en-US', {
    timeZone: 'Asia/Manila',
    weekday: 'long',
    month: 'long',
    day: 'numeric',
    year: 'numeric',
    hour: 'numeric',
    minute: '2-digit',
    hour12: true
  });
}

/* =====================================================
   1️⃣ AWS HANDLER — Unsettling Question via Lambda
   ===================================================== */

async function generateUnsettlingQuestion() {
  const apiEndpoint = 'https://jd6xzj4apg.execute-api.ap-southeast-2.amazonaws.com/api/generate';
  const manilaTime = getCurrentManilaTime();

  const payload = {
 const payload = {
  prompt: `Generate one unsettling question (12–20 words) that:
- Feels like it knows something personal
- References the current time
- Uses “you” or “your”
- Tone: introspective and a bit uncanny
It is currently ${manilaTime} in Manila.  
Return only the question.`
};
    }
  };

  try {
    const response = await fetch(apiEndpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    if (!response.ok) throw new Error(`Claude Lambda Error ${response.status}`);
    const data = await response.json();
    const text = data.content?.[0]?.text?.trim() ||
      "What's something you've been meaning to do but keep putting off?";
    console.log('✅ Lambda success:', text);
    return text;
  } catch (e) {
    console.error('❌ Unsettling Question Error:', e);
    return "What's something you've been meaning to do but keep putting off?";
  }
}

/* =====================================================
   2️⃣ USER INPUT HANDLING
   ===================================================== */

async function handleSend() {
  const txt = userInput.value.trim();
  if (!txt) return false;
  addMessage(txt, false);
  userInput.value = '';

  if (currentStage === 'firstQuery') {
    const lower = txt.toLowerCase();
    if (lower.includes('date') || lower.includes('time')) {
      const now = getCurrentManilaTime();
      addMessage(`Currently it's ${now} in Manila.`);
    } else {
      const now = getCurrentManilaTime();
      addMessage(`Today is ${now}. Here are today's top headlines across the web.`);
    }
    setTimeout(() => document.getElementById('modal3').classList.remove('hidden'), 1000);

  } else if (currentStage === 'specificFavourites') {
    addMessage("Thank you for sharing! Let me think on that...");
    setTimeout(async () => {
      const q = await generateUnsettlingQuestion();
      currentStage = 'userGoals';
      addMessage(q);
    }, 1000);
  }
  return false;
}

  /* ===========================
     Modal 3 – About You
  =========================== */
  const modal3Button = document.getElementById('modal3Button');
  if (modal3Button) {
    modal3Button.addEventListener('click', () => {
      console.log("✅ Modal 3 clicked — opening Modal 4");
      document.getElementById('modal3').classList.add('hidden');
      document.getElementById('modal4').classList.remove('hidden');

      // set conversation state and nudge user
      currentStage = 'awaitingRole';
      addMessage("Tell me a bit about yourself — are you a student, professional, or something else?");
    });
  }

  /* ===========================
     Modal 4 – Personalization
  =========================== */
  const modal4Button = document.getElementById('modal4Button');
  if (modal4Button) {
    modal4Button.addEventListener('click', () => {
      console.log("✅ Modal 4 clicked — opening interests modal 5");
      document.getElementById('modal4').classList.add('hidden');

      // Message transition
      addMessage("Great! Let’s personalize your experience. Select your interests and favourites next.");

      // open interests modal if present
      const modal5 = document.getElementById('modal5');
      if (modal5) modal5.classList.remove('hidden');
      currentStage = 'selectingPreferences';
    });
  }
/* Enter key shortcut */
userInput.addEventListener('keypress', e => {
  if (e.key === 'Enter') {
    e.preventDefault();
    handleSend();
  }
});
  
</script>
  
</body>
</html>
