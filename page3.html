<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>RetroMart - Diagnostic Version</title>
  <style>
    body {background:#e9edf5; font-family: Arial, Helvetica, sans-serif; color:#000; margin:0; padding:20px;}
    .wrap {width:980px; margin:0 auto; background:#fff; border:3px double #003366; box-shadow:0 0 12px #666;}
    .header {background:#003366; color:#fff; padding:12px; text-align:center; border-bottom:4px ridge #ccc;}
    .header h1 {margin:0; font-size:22px; text-shadow:1px 1px #000;}
    .nav {background:#f2f6fa; border-bottom:2px solid #003366; text-align:center; padding:6px; font-size:12px;}
    .nav a {color:#003366; text-decoration:none; margin:0 6px;}
    .nav a:hover {text-decoration:underline;}
    .searchbar {padding:10px; background:#dfe7f3; border-bottom:2px groove #999; text-align:center;}
    .searchbar input[type=text] {width:300px; padding:4px; border:1px solid #999;}
    .searchbar input[type=submit] {background:#003366; color:#fff; border:1px solid #000; padding:4px 10px; font-weight:bold; cursor:pointer;}
    .list-table {width:100%; border-collapse:collapse; font-size:13px;}
    .list-table th {background:#e0e9f8; border-bottom:3px double #003366; padding:8px; color:#003366; text-align:left;}
    .list-table td {border-bottom:1px dashed #999; padding:10px; vertical-align:top;}
    .item-title {font-weight:bold; color:#003366; font-size:14px;}
    .price {color:#b12704; font-weight:bold; font-size:14px;}
    .desc {font-size:12px; color:#222; margin-top:6px;}
    .rating {font-size:13px; color:#555; margin-top:4px;}
    .rating-stars {color:#ff9900; font-weight:bold; letter-spacing:2px;}
    .review {font-style:italic; color:#333; margin-top:4px; font-size:12px;}
    .footer {background:#003366; color:#fff; text-align:center; padding:12px; border-top:3px ridge #ccc; font-size:11px;}
    marquee {background:#dfe7f3; padding:4px; border-bottom:2px groove #999; color:#003366; font-weight:bold;}
    .creepy {color: #b21; font-weight: bold;}
    .diagnostic {
      background: #ffffcc;
      border: 3px solid #ff9900;
      padding: 15px;
      margin: 20px;
      font-family: monospace;
      font-size: 13px;
    }
    .diagnostic h3 {
      margin-top: 0;
      color: #cc6600;
    }
    .success { color: green; font-weight: bold; }
    .error { color: red; font-weight: bold; }
    .warning { color: orange; font-weight: bold; }
  </style>
</head>
<body>
  <div class="diagnostic">
    <h3>üîç Diagnostic Panel</h3>
    <div id="diagnostic-output">Running diagnostics...</div>
  </div>

  <div class="wrap">
    <div class="header">
      <h1>üõí RetroMart - Diagnostic Mode</h1>
    </div>

    <div class="nav">
      <a href="#">Home</a> | <a href="#">Categories</a> | <a href="#">My Account</a>
    </div>

    <marquee scrollamount="3" id="marquee-text">üî• Loading personalized recommendations... üî•</marquee>

    <div class="searchbar">
      <form onsubmit="return false;">
        <input type="text" id="q" placeholder="Search for products...">
        <input type="submit" value="Search">
      </form>
    </div>

    <table class="list-table">
      <thead>
        <tr>
          <th style="width:5%">#</th>
          <th style="width:45%">Item</th>
          <th style="width:15%">Price</th>
          <th style="width:35%">Review & Rating</th>
        </tr>
      </thead>
      <tbody id="products-table">
        <tr>
          <td colspan="4" style="text-align:center; padding:20px;">
            <em>Loading products...</em>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="footer">
      &copy; 2025 RetroMart | Diagnostic Mode
    </div>
  </div>

  <script src="core-system.js"></script>
  <script>
    // Diagnostic output helper
    function log(message, type = 'info') {
      const output = document.getElementById('diagnostic-output');
      const colors = {
        success: 'success',
        error: 'error',
        warning: 'warning',
        info: ''
      };
      output.innerHTML += `<div class="${colors[type]}">${message}</div>`;
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    // Clear initial message
    document.getElementById('diagnostic-output').innerHTML = '';

    // Step 1: Check if script is running
    log('‚úì JavaScript is executing', 'success');

    // Step 2: Check if core-system.js loaded
    if (typeof HypertextCore === 'undefined') {
      log('‚úó ERROR: HypertextCore not found!', 'error');
      log('‚Üí core-system.js did not load', 'error');
      log('‚Üí Check if file exists in same folder', 'error');
    } else {
      log('‚úì HypertextCore loaded successfully', 'success');
      
      // Step 3: Track page visit
      try {
        HypertextCore.trackPageVisit('Act3_Shop');
        log('‚úì Page visit tracked', 'success');
      } catch(e) {
        log('‚úó Error tracking visit: ' + e.message, 'error');
      }

      // Step 4: Get user data
      const userGoals = HypertextCore.getUserGoals() || 'achieve your goals';
      const userInterests = HypertextCore.getUserInterests() || ['Gaming', 'Technology'];
      const userFavourites = HypertextCore.getUserFavourites() || ['Minecraft', 'Coding'];
      const sessionId = HypertextCore.sessionId || 'USER_000000';
      
      log('User Goals: ' + userGoals, userGoals === 'achieve your goals' ? 'warning' : 'success');
      log('User Interests: ' + userInterests.join(', '), 'info');
      log('User Favourites: ' + userFavourites.join(', '), 'info');
      log('Session ID: ' + sessionId, 'info');

      // Step 5: Update marquee
      try {
        document.getElementById('marquee-text').innerHTML = `üî• Welcome! Items for ${userInterests[0]} fans! üî•`;
        log('‚úì Marquee updated', 'success');
      } catch(e) {
        log('‚úó Error updating marquee: ' + e.message, 'error');
      }

      // Step 6: Generate products array
      log('Generating products array...', 'info');
      
      const products = [
        {
          title: `${userInterests[0]} Starter Kit`,
          desc: `Everything you need to get started with ${userInterests[0]}.`,
          price: '$29.99',
          rating: '4.5 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ',
          review: 'Perfect for beginners!',
          reviewer: 'HobbyFan2005'
        },
        {
          title: `${userFavourites[0]} Collection`,
          desc: `Exclusive merchandise for ${userFavourites[0]} fans.`,
          price: '$49.99',
          rating: '4.8 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ',
          review: 'Amazing quality!',
          reviewer: 'Collector99'
        },
        {
          title: 'Student Productivity Bundle',
          desc: 'Perfect for Filipino college students who need organization tools.',
          price: '$34.99',
          rating: '4.2 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ',
          review: 'Helped me stay on track!',
          reviewer: 'Manile√±oStudent'
        },
        {
          title: `"${userGoals}" Achievement System`,
          desc: `Designed specifically for you based on your browsing patterns.`,
          price: '$59.99',
          rating: '4.7 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ',
          review: 'Finally something that works!',
          reviewer: 'MotivatedUser'
        },
        {
          title: `${userInterests[0]} + ${userGoals} Planner`,
          desc: `Combine your love of ${userInterests[0]} with achieving ${userGoals}.`,
          price: '$44.99',
          rating: '4.6 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ',
          review: 'Makes goals fun!',
          reviewer: 'PlannerPro'
        },
        {
          title: '"' + userGoals + '" Complete Guide',
          desc: 'Stop procrastinating. Recommended for Metro Manila users.',
          price: '$39.99',
          rating: '4.7 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ',
          review: 'Just buy it already.',
          reviewer: 'YourConscience'
        },
        {
          title: `${userInterests[0]} + ${userInterests[1] || 'Interest'} Bundle`,
          desc: `Includes: ${userFavourites.slice(0, 3).join(', ')}. Made for your profile.`,
          price: '$89.99',
          rating: '4.9 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ',
          review: 'Exactly what I needed!',
          reviewer: 'BundleBuyer'
        },
        {
          title: userGoals,
          desc: 'Based on your session data. Still haven\'t started, have you?',
          price: '$79.99',
          rating: '3.2 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ',
          review: 'Procrastinating by shopping for it...',
          reviewer: 'IronicUser'
        },
        {
          title: 'Premium Data Package',
          desc: `Behavioral analysis for ${userInterests.join(', ')} enthusiasts. For advertisers.`,
          price: '$199.99',
          rating: '4.8 / 5',
          stars: '‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ',
          review: '94% conversion rate!',
          reviewer: 'MarketingTeam'
        },
        {
          title: `Your Profile - User #${sessionId.replace('USER_', '')}`,
          desc: `Complete data package: "${userGoals}", ${userInterests.length} interests, resale rights included.`,
          price: '$0.47',
          rating: '???',
          stars: '‚ö†‚ö†‚ö†‚ö†‚ö†',
          review: 'Purchased 47 times by advertisers.',
          reviewer: 'SYSTEM'
        }
      ];

      log(`‚úì Generated ${products.length} products`, 'success');

      // Step 7: Get table body element
      const tableBody = document.getElementById('products-table');
      if (!tableBody) {
        log('‚úó ERROR: products-table element not found!', 'error');
      } else {
        log('‚úì Found products-table element', 'success');
        
        // Step 8: Clear loading message
        tableBody.innerHTML = '';
        log('‚úì Cleared loading message', 'success');
        
        // Step 9: Render products
        log('Rendering products to DOM...', 'info');
        let renderedCount = 0;
        
        products.forEach((product, index) => {
          try {
            const row = document.createElement('tr');
            
            row.innerHTML = `
              <td>${index + 1}</td>
              <td>
                <div class="item-title">${product.title}</div>
                <div class="desc">${product.desc}</div>
              </td>
              <td class="price">${product.price}</td>
              <td>
                <div class="rating">Rating: ${product.rating}</div>
                <div class="rating-stars">${product.stars}</div>
                <div class="review">"${product.review}" - ${product.reviewer}</div>
              </td>
            `;
            
            tableBody.appendChild(row);
            renderedCount++;
          } catch(e) {
            log(`‚úó Error rendering product ${index + 1}: ${e.message}`, 'error');
          }
        });
        
        log(`‚úì Successfully rendered ${renderedCount}/${products.length} products`, 'success');
        
        // Step 10: Verify DOM
        const rowCount = tableBody.querySelectorAll('tr').length;
        log(`‚úì DOM verification: ${rowCount} rows in table`, rowCount === products.length ? 'success' : 'warning');
      }
    }

    // Final status
    setTimeout(() => {
      log('\n=== DIAGNOSTIC COMPLETE ===', 'success');
      log('If products are not visible above, check browser console for errors', 'info');
    }, 100);
  </script>
</body>
</html>